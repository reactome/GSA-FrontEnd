<mat-expansion-panel #mep="matExpansionPanel" [expanded]="true" hideToggle>
  <mat-expansion-panel-header>
    <div *ngIf="currentDataset.summary === undefined; else title" class="italic">New Dataset</div>
    <ng-template #title>
      <div class="container-expansion-title full-width horizontal">
        <div class="flex-data-container vertical">
          <span class="bold">{{currentDataset.summary?.title}}</span>
          <span
            *ngIf="currentDataset.statisticalDesign?.analysisGroup"> {{currentDataset.statisticalDesign?.analysisGroup}}
            :
            <span *ngIf="currentDataset.statisticalDesign?.comparisonGroup1">
                  {{currentDataset.statisticalDesign?.comparisonGroup1}}
              vs. {{currentDataset.statisticalDesign?.comparisonGroup2}}
          </span></span>
        </div>
        <button (click)="deleteDataset()" *ngIf="currentDataset.saved"
                aria-label="Example icon button with a vertical three dot icon" color="primary"
                mat-icon-button><span
          class="material-icons">delete</span>
        </button>
      </div>
    </ng-template>
  </mat-expansion-panel-header>

  <mat-vertical-stepper #nestedStepper linear>
    <mat-step #select [completed]="currentDataset.table !== undefined">
      <ng-template matStepLabel>Select a dataset</ng-template>
      <div class="flex-container flex-center vertical">
        <gsa-select-dataset *ngIf="nestedStepper.selected == null || nestedStepper.selected == select"
                            [dataset]="currentDataset"></gsa-select-dataset>
        <button [disabled]="!select.completed" color="accent" mat-fab
                matStepperNext>
          <mat-icon>keyboard_arrow_down</mat-icon>
        </button>
      </div>
    </mat-step>

    <mat-step #annotate completed="false">
      <ng-template matStepLabel>Annotate your dataset</ng-template>
      <div class="flex-container flex-center vertical">
        <button class="nav-btn-margin" color="accent" mat-fab matStepperPrevious>
          <mat-icon>keyboard_arrow_up</mat-icon>
        </button>
        <gsa-annotate-dataset *ngIf="nestedStepper.selected == annotate" [currentDataset]="currentDataset"
                              class="full-width"></gsa-annotate-dataset>
        <button (click)="setValidStatisticalDesign()" class="nav-btn-margin" color="accent" mat-fab matStepperNext>
          <mat-icon>keyboard_arrow_down</mat-icon>
        </button>
      </div>
    </mat-step>

    <mat-step #statisticDesign completed="false">
      <ng-template matStepLabel>Statistical Design</ng-template>
      <div class="flex-container flex-center vertical">
        <button class="nav-btn-margin" color="accent" mat-fab matStepperPrevious>
          <mat-icon>keyboard_arrow_up</mat-icon>
        </button>
        <gsa-statistical-design *ngIf="nestedStepper.selected == statisticDesign" [currentDataset]="currentDataset"
                                class="full-width"></gsa-statistical-design>
        <button (click)="saveData(); nestedStepper.selected = annotate; mep.expanded = false;"
                [disabled]="this.currentDataset.statisticalDesign?.analysisGroup === undefined || this.currentDataset.statisticalDesign?.comparisonGroup1 === undefined || this.currentDataset.statisticalDesign?.comparisonGroup2 === undefined"
                class="nav-btn-margin"
                color="primary"
                mat-raised-button>
          Save Dataset
        </button>
      </div>
    </mat-step>
  </mat-vertical-stepper>
</mat-expansion-panel>
